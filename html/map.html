<html>
<head>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.vectorgrid@1.2.0"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
</head>
<body>
<script>
var MAPBOX_URL = 'https://api.mapbox.com/styles/v1/mapbox/light-v9/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoiYW5kcmV3ZWxhbmQiLCJhIjoiWFQxTW5HdyJ9.nmZbHHvtnEQHP8iy9ibtQg';
var WIDTH = 1000, HEIGHT = 1000;
var CENTER = L.latLng(51.549180, -0.140962);
var options = {
  dragging: true,
  touchZoom: false,
  scrollWheelZoom: false,
  zoomControl: true,
  attributionControl: false
};
var div = d3.select('body').append('div')
  .attr('id', 'map')
  .attr('style', 'width: ' + WIDTH + 'px; height: ' + HEIGHT + 'px;');
var map = L.map('map', options).setView([CENTER.lat, CENTER.lng], 16);
L.tileLayer(MAPBOX_URL).addTo(map);
metersToPixels = function(map, meters) {
  centerLatLng = map.getCenter();
  centerPoint = map.latLngToContainerPoint(centerLatLng);
  deltaLatLng = map.containerPointToLatLng(L.point(centerPoint.x + 1, centerPoint.y));
  metersPerPixel = centerLatLng.distanceTo(deltaLatLng);
  return meters / metersPerPixel;
}

vectorTileOptions = {
  vectorTileLayerStyles: {
    trees: function(properties, zoom) {
      return {
        radius: metersToPixels(map, properties.spread),
        stroke: true,
        weight: 1,
        fill: true,
        color: "#41ab5d",
        fillColor: "#41ab5d",
        fillOpacity: 0.5,
      }
    },
    estates: function(properties, zoom) {
      points = properties.points2 || 0.0
      radius = Math.sqrt(properties.bedrooms)
      if (points > 0.0) {
        // See https://runkit.com/npm/d3-scale-chromatic
        color = d3.interpolateYlOrRd((points - 500.0)/500.0);
        return {
          radius: radius,
          stroke: true,
          weight: 1,
          fill: true,
          color: color,
          fillColor: color,
          fillOpacity: 1.0,
        }
      } else {
        return {
          radius: radius,
          stroke: true,
          fill: false,
          color: "#f7f7f7",
          fillColor: "#f7f7f7",
          fillOpacity: 1.0,
        }
      }
    },
  },
};
L.vectorGrid.protobuf("/tile/{z}/{x}/{y}.mvt", vectorTileOptions).addTo(map);
</script>
</body>
</html>
